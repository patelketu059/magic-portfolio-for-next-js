@use "./breakpoints.scss" as breakpoints;

.mask {
    pointer-events: none;
    backdrop-filter: blur(0.5rem);
    background: linear-gradient(to bottom, var(--page-background), var(--static-transparent));
    mask-image: linear-gradient(rgba(0,0,0) 25%, rgba(0, 0, 0, 0) 100%);
    mask-size: 100% 100%;
}

.navLink {
    text-decoration: none;
    color: var(--neutral-on-background-medium);
    font-size: 0.875rem;
    font-weight: 500;
    letter-spacing: 0.05em;
    transition: color 0.2s ease;
    position: relative;
    /* align nav links like icon buttons */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 36px;
    padding: 0 10px;

    &:hover {
        color: var(--neutral-on-background-strong);
    }

    &[data-active="true"] {
        color: var(--brand-on-background-strong);
        
        &::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--brand-on-background-strong);
        }
    }
}

.navigation {
    display: flex;
    gap: 1rem; /* slightly tighter spacing */
    align-items: center;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    /* center the nav using the header's flex layout instead of absolute positioning */
    position: static;
    margin: 0 auto;
    transform: none;
}

/* prevent visual selection highlight inside the nav */
.navigation ::selection,
.toggleBtn ::selection,
.navLink ::selection {
    background: transparent;
    color: inherit;
}

/* small wrapper so ThemeToggle visually matches nav buttons */
.toggleBtn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 0 10px;
    border-radius: 999px;
    background: var(--surface-transparent, transparent);
    border: 1px solid var(--neutral-outline, transparent);
    transition: background 160ms ease, border-color 160ms ease, transform 120ms ease;
    min-width: 36px;
    height: 36px;
    box-sizing: border-box;

    &:hover {
        background: var(--surface-hover, rgba(0,0,0,0.04));
        transform: translateY(-1px);
    }

    &[data-active="true"] {
        background: var(--brand-surface, rgba(99,102,241,0.12));
        border-color: var(--brand-on-background-strong);
    }

        /* remove default focus ring when not keyboard-focused (preserve :focus-visible for a11y) */
        &:focus:not(:focus-visible) {
                outline: none;
                box-shadow: none;
        }

        /* ensure any generated selection highlight is invisible */
        &::selection {
            background: transparent;
            color: inherit;
        }

        /* hide decorative underline that applies to .navLink[data-active] for icon-only buttons */
        &::after {
            display: none !important;
        }

        /* darker icon when selected */
        &[data-active="true"] .navIcon {
                color: var(--brand-on-background-strong);
        }

    /* Tooltip label for icon buttons */
    .navLabel {
        position: absolute;
        bottom: calc(100% + 8px);
        left: 50%;
        transform: translateX(-50%) translateY(0);
        background: var(--neutral-on-background-strong);
        color: var(--static-white);
        padding: 6px 8px;
        border-radius: 6px;
        font-size: 0.78rem;
        white-space: nowrap;
        display: inline-block;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity 120ms ease, transform 120ms ease, visibility 0s linear 120ms;
        box-shadow: 0 6px 18px rgba(0,0,0,0.12);
        z-index: 40;
    }

    &:hover .navLabel {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        transform: translateX(-50%) translateY(-6px);
        transition-delay: 0s;
    }

    /* also show tooltip when keyboard-focused for accessibility */
    &:focus-within .navLabel,
    &:focus .navLabel {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        transform: translateX(-50%) translateY(-6px);
        transition-delay: 0s;
    }
}

/* Hide any remaining decorative underline for icon-only nav links */
.navigation .navLink[data-active="true"]::after {
    display: none !important;
}

/* Ensure ThemeToggle internal button doesn't show a white outline on mouse click
     but keep keyboard-visible focus for a11y */
.toggleBtn :global(button):focus:not(:focus-visible) {
    outline: none !important;
    box-shadow: none !important;
}
.toggleBtn :global(button) {
  /* when ThemeToggle renders a button internally, make it fit */
  padding: 0;
  margin: 0;
}

.position {
    /* ensure header sits above decorative background */
    z-index: 20;
    position: relative;
}

/* make left/right sides equal width so center nav is visually centered */
.side {
    /* responsive side width so header centers correctly at all sizes */
    min-width: clamp(96px, 12vw, 180px);
    display: flex;
    align-items: center;
}
.side.left {
    justify-content: flex-start;
}
.side.right {
    justify-content: flex-end;
}

.navIcon {
    vertical-align: middle;
    font-size: 1.125rem;
    margin-right: 0;
    color: var(--neutral-on-background-medium);
}

/* Fallback navLabel in case it's used outside .toggleBtn context */
.navLabel {
    display: inline-block;
}

/* Mobile menu toggle (hidden by default, shown at tablet/smaller widths) */
.mobileToggle {
    display: none;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 36px;
    border-radius: 999px;
    /* translucent background so the hamburger feels light on top of content */
    background: rgba(0,0,0,0.04);
    border: 1px solid var(--neutral-outline, transparent);
    cursor: pointer;
    transition: background 160ms ease, border-color 160ms ease, transform 120ms ease;
    padding: 0 8px;
}

.mobileToggle .navIcon {
    opacity: 0.9;
    transition: opacity 120ms ease, color 120ms ease;
}
.mobileToggle:hover {
    background: rgba(0,0,0,0.06);
}
.mobileToggle:active {
    transform: translateY(1px);
}
.mobileToggle:focus-visible {
    outline: 2px solid rgba(0,0,0,0.08);
    outline-offset: 2px;
}

.hamburger,
.hamburgerOpen {
    display: inline-block;
    width: 20px;
    height: 2px;
    background: currentColor;
    position: relative;
}
.hamburger::before,
.hamburger::after,
.hamburgerOpen::before,
.hamburgerOpen::after {
    content: "";
    position: absolute;
    left: 0;
    width: 100%;
    height: 2px;
    background: currentColor;
    transition: transform 180ms ease, opacity 120ms ease;
}
.hamburger::before { top: -6px; }
.hamburger::after { top: 6px; }
.hamburgerOpen { background: transparent; }
.hamburgerOpen::before { transform: rotate(45deg); top: 0; }
.hamburgerOpen::after { transform: rotate(-45deg); top: 0; }

/* Mobile nav (hidden by default) */
.mobileNav {
    /* start hidden with zero max-height for smooth slide */
    display: block;
    max-height: 0;
    overflow: hidden;
    position: fixed;
    top: 80px;
    left: 0;
    right: 0;
    background: var(--page-background);
    border-bottom: 1px solid var(--neutral-outline, rgba(0,0,0,0.06));
    z-index: 60;
    padding: 0 20px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    opacity: 0;
    transform: translateY(-6px);
    transition: max-height 260ms cubic-bezier(.2,.9,.2,1), opacity 200ms ease, transform 220ms ease;
}
.mobileNav.open {
    max-height: 420px; /* large enough for nav content */
    padding: 12px 20px;
    opacity: 1;
    transform: translateY(0);
}
.mobileNav nav {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 6px;
}
.mobileNavLink {
    width: 100%;
    justify-content: flex-start;
    padding: 10px 12px;
}

/* When the nav receives the .open class (from Header) we treat it as the mobile dropdown */
.navigation.open {
    /* mobile dropdown appearance */
    display: block;
    position: fixed;
    top: 80px;
    left: 0;
    right: 0;
    background: var(--page-background);
    border-bottom: 1px solid var(--neutral-outline, rgba(0,0,0,0.06));
    z-index: 60;
    padding: 12px 20px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    max-height: 420px;
    overflow: hidden;
    opacity: 1;
    transform: translateY(0);
    transition: max-height 260ms cubic-bezier(.2,.9,.2,1), opacity 200ms ease, transform 220ms ease;
}
.navigation.open > a,
.navigation.open > .toggleBtn {
    display: flex;
    flex-direction: row;
    gap: 12px;
    align-items: center;
    /* make inline nav items appear as outlined, transparent buttons */
    background: transparent !important;
    border: 1px solid var(--neutral-outline, rgba(0,0,0,0.06));
    padding: 8px 12px;
    border-radius: 8px;
}

/* When the navigation is opened (mobile) show inline labels instead of tooltips */
.navigation.open .navLabel {
    position: static;
    bottom: auto;
    left: auto;
    transform: none;
    opacity: 1 !important;
    visibility: visible !important;
    pointer-events: auto !important;
    margin-left: 8px;
    /* show label text with transparent fill and visible outline on the parent */
    background: transparent !important;
    color: var(--neutral-on-background-strong) !important;
    padding: 0 !important;
    font-weight: 600;
}

/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
    .navigation,
    .navigation.open,
    .hamburger,
    .hamburgerOpen,
    .toggleBtn .navLabel {
        transition: none !important;
    }
}

/* Plain text variant for the left-side role label: matches nav font but without button visuals */
.roleText {
    color: var(--neutral-on-background-medium);
    /* match nav label style from design: slightly larger, heavier, wide tracking */
    font-family: var(--font-label, inherit);
    font-size: clamp(0.9rem, 1.2vw, 1rem);
    font-weight: 700;
    letter-spacing: 0.22em;
    text-transform: uppercase;
    display: inline-block;
    padding: 0;
    height: auto;
    line-height: 1;
}

/* Hide the large role label on small screens to save space */
@media (max-width: 640px) {
    .roleText {
        display: none;
    }
}

@include breakpoints.m {
    .navigation {
        display: none;
    }
    .mobileToggle {
        display: inline-flex;
    }
}

/* When the mobile nav opens, the nav becomes a sibling before the toggle wrapper.
   Make the toggle wrapper get pushed down so the mobile role label moves below the open dropdown. */
.navigation.open + .mobileToggleWrap {
    /* keep the toggle button in-place; only move the role label beneath it */
    margin-top: 0;
}

/* When nav is open, hide the mobile role label so it disappears cleanly */
.navigation.open + .mobileToggleWrap .mobileRole {
    transform: translateY(6px);
    transition: transform 180ms cubic-bezier(.2,.9,.2,1), opacity 160ms ease, visibility 0s linear 160ms;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
}

@media (max-width: 640px) {
    .navLink {
        font-size: 0.78rem;
        height: 32px;
        padding: 0 8px;
    }

    .side {
        min-width: 64px;
    }
}

/* Mobile: give the header a theme-matching background so the nav feels integrated
   with the site's theme when viewed on small screens. Uses theme CSS variables
   so it respects light/dark modes. */
@media (max-width: 640px) {
    .position {
        background: var(--page-background);
        backdrop-filter: blur(6px);
        border-bottom: 1px solid var(--neutral-outline, rgba(0,0,0,0.06));
        transition: background 160ms ease, border-color 160ms ease, backdrop-filter 160ms ease;
    }

    /* Ensure the sticky/fixed header restores its own stacking context */
    .position[style] {
        -webkit-backdrop-filter: blur(6px);
    }
}

@include breakpoints.s {
    .position {
        top: auto;
        bottom: var(--static-space-24);
    }

    .mask {
        transform: rotate(180deg);
        bottom: 0;
    }
}

/* Mobile-only role label shown beneath the hamburger icon */
.mobileToggleWrap {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
}

.mobileRole {
    display: none;
    font-family: var(--font-label, inherit);
    font-size: 0.78rem;
    font-weight: 700;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    margin-top: 6px;
    color: var(--neutral-on-background-medium);
}

@media (max-width: 640px) {
    .mobileRole {
        display: inline-block;
    }
}